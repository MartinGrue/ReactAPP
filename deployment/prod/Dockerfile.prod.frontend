#BUILD THIS IMAGE WITH DOCKERBUILDKIT OR INGORE FILES WILL BE IGNORED
FROM node:alpine as build-stage
WORKDIR /app
COPY ./client-app/package.json .
RUN npm install --verbose 
COPY ./client-app/ .
RUN  npm run build

FROM nginx
COPY --from=build-stage /app/build/ /var/www/html
COPY ./deployment/prod/nginx.conf /etc/nginx/conf.d/default.conf
RUN find /var/www/html/static/js -type f -name "main.*.js" -delete
RUN find /var/www/html/static/js -type f -name "2.*.js" -delete